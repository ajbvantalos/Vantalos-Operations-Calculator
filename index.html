<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Avenor/Vantalos Unit Economics Planner — Responsive</title>
  <style>
    :root{
      --bg:#0b0c10; --surface:#131827; --surface-2:#1a2133; --surface-3:#212a41;
      --text:#eef0f4; --muted:#9ea6ba; --accent:#d3b99c; --border:#2a3350;
      --radius:14px; --shadow:0 8px 28px rgba(0,0,0,.4);
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; -webkit-text-size-adjust:100%;}
    body{overflow-x:hidden;}
    h1{font-size:1.6rem;margin:0}
    h2{font-size:1rem;color:var(--muted);margin:.2rem 0 .6rem}
    h3{font-size:.95rem;color:var(--accent);margin:0 0 .4rem}
    p{margin:.2rem 0;color:var(--muted)}

    .app{max-width:1360px;width:100%;margin:0 auto;padding:18px}
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px;flex-wrap:wrap}
    .brand{display:flex;gap:10px;align-items:center;min-width:260px}
    .dot{width:10px;height:10px;border-radius:50%;background:var(--accent);box-shadow:0 0 0 6px #d3b99c22}

    /* Layout: force single-column vertical structure */
    .layout{display:grid;grid-template-columns:1fr;gap:18px}

    .panel{background:linear-gradient(180deg,var(--surface),var(--surface-2));border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow)}
    .inner{padding:14px}

    /* Inputs sidebar */
    .group{border-top:1px solid var(--border)}
    .group:first-child{border-top:0}
    .group header{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;cursor:pointer}
    .group header:hover{background:var(--surface-3)}
    .group header h3{margin:0}
    .group .body{padding:0 14px 14px}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:10px}

    label{font-size:.82rem;color:var(--muted)}
    input,select{width:100%;border:1px solid var(--border);background:#161d2d;color:var(--text);padding:10px;border-radius:10px;font-size:.95rem;outline:none;transition:.2s}
    input:focus,select:focus{border-color:var(--accent);box-shadow:0 0 0 3px #d3b99c33}

    /* Results */
    .results{display:grid;grid-template-rows:auto auto 1fr;gap:16px}

    .toolbar{position:sticky;top:10px;z-index:5;display:flex;gap:8px;align-items:center;flex-wrap:wrap;background:linear-gradient(180deg,var(--surface),var(--surface-2));border:1px solid var(--border);border-radius:12px;padding:10px 10px;box-shadow:var(--shadow)}
    .toolbar > *{flex:0 0 auto}
    .toolbar select,.toolbar input{min-width:120px}
    .toolbar .btn{min-height:40px}

    button{border:none;border-radius:10px;padding:10px 12px;font-weight:700;cursor:pointer}
    .btn{background:var(--accent);color:#16181f}
    .btn.ghost{background:transparent;color:var(--text);border:1px solid var(--border);font-weight:600}

    /* KPIs: keep 2 columns to reduce wrap */
    .kpi-grid{display:grid;grid-template-columns:repeat(2,minmax(260px,1fr));gap:12px;grid-auto-rows:minmax(74px,auto)}
    .kpi{background:var(--surface-3);border:1px solid var(--border);border-radius:12px;padding:10px;overflow:hidden}
    .kpi .value{font-weight:800;font-size:1.25rem;line-height:1.15;white-space:normal;overflow-wrap:anywhere;word-break:break-word}
    .kpi .label{font-size:.85rem;color:var(--muted);white-space:normal;overflow-wrap:anywhere;word-break:break-word}

    /* Cards below KPIs: make them vertical too */
    .two-col{display:grid;grid-template-columns:1fr;gap:16px}

    .list{display:flex;flex-direction:column;gap:8px}
    .item{display:flex;gap:12px;align-items:flex-start;justify-content:space-between;background:#1a2133;border:1px solid var(--border);border-radius:12px;padding:8px 10px;overflow:hidden}
    .item span{white-space:normal;overflow-wrap:anywhere;word-break:break-word}
    .item span:first-child{flex:1 1 60%;min-width:0}
    .item span:last-child{flex:1 1 40%;min-width:0;text-align:right}

    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}

    /* --- Responsive tweaks (preserve vertical order on all sizes) --- */
    @media (max-width: 1200px){
      .grid-2{grid-template-columns:1fr 1fr}
    }
    @media (max-width: 1000px){
      .grid-2{grid-template-columns:1fr 1fr}
    }
    @media (max-width: 900px){
      .grid-2{grid-template-columns:1fr}
      .topbar{justify-content:flex-start}
      .toolbar select,.toolbar input{min-width:unset;flex:1 1 120px}
      .toolbar .btn{flex:1 1 140px}
      .kpi-grid{grid-template-columns:1fr} /* on small screens, 1 per row */
    }
    @media (max-width: 500px){
      .app{padding:12px}
      .brand h1{font-size:1.2rem}
      .brand h2{font-size:.9rem}
      input,select{font-size:16px} /* avoid iOS zoom on focus */
      .toolbar .btn{width:100%}
    }

    @media (prefers-reduced-motion: reduce){
      *{scroll-behavior:auto; animation:none; transition:none}
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="topbar">
      <div class="brand">
        <div class="dot"></div>
        <div>
          <h1>Avenor/Vantalos Unit Economics Planner</h1>
          <h2>Commission = 15% of Avenor revenue from our leads, **only** above $3,100/mo threshold.</h2>
        </div>
      </div>
      <div class="toolbar">
        <select id="currency"><option value="USD">$ USD</option><option value="GBP">£ GBP</option></select>
        <input id="fx" type="number" step="0.0001" value="0.78" title="FX (1 USD → GBP)"/>
        <button class="btn" id="recalc">Recalculate</button>
        <button class="btn ghost" id="export">Export JSON</button>
        <button class="btn ghost" id="import">Import JSON</button>
        <button class="btn ghost" id="resetAll">Reset</button>
      </div>
    </div>

    <div class="layout">
      <!-- Inputs (now always first) -->
      <aside class="panel" aria-label="Inputs">
        <div class="inner">
          <div class="group" data-open="true">
            <header><h3>Avenor Revenue (per active carrier)</h3><span>monthly</span></header>
            <div class="body">
              <div class="grid-2">
                <div><label for="revTypical">Typical ($/carrier)</label><input id="revTypical" type="number" value="800"></div>
                <div><label for="revGood">Good month ($/carrier)</label><input id="revGood" type="number" value="1000"></div>
                <div><label for="useGood">Use good month?</label><select id="useGood"><option value="no">No</option><option value="yes">Yes</option></select></div>
                <div></div>
                <div><label for="avenorPct">Avenor dispatch % (current)</label><input id="avenorPct" type="number" step="0.1" value="5"></div>
                <div><label for="avenorPctWhatIf">What-if dispatch %</label><input id="avenorPctWhatIf" type="number" step="0.1" value="5"></div>
              </div>
            </div>
          </div>

          <div class="group" data-open="true">
            <header><h3>Commission (Vantalos)</h3><span>thresholded</span></header>
            <div class="body">
              <div class="grid-2">
                <div><label for="threshold">Threshold ($)</label><input id="threshold" type="number" value="3100"></div>
                <div><label for="rate">Rate above threshold (%)</label><input id="rate" type="number" step="0.1" value="15"></div>
                <div style="grid-column:1/3"><label for="targetCommission">Target commission ($)</label><input id="targetCommission" type="number" value="2700"></div>
              </div>
            </div>
          </div>

          <div class="group" data-open="true">
            <header><h3>Funnel</h3><span>pre-data</span></header>
            <div class="body">
              <div class="grid-2">
                <div><label for="pCE">Contact → Engaged (%)</label><input id="pCE" type="number" step="0.1" value="20"></div>
                <div><label for="pEO">Engaged → Onboarded (%)</label><input id="pEO" type="number" step="0.1" value="50"></div>
                <div><label for="pOA">Onboarded → Active (%)</label><input id="pOA" type="number" step="0.1" value="70"></div>
                <div><label for="buffer">Buffer (%)</label><input id="buffer" type="number" step="0.1" value="20"></div>
              </div>
            </div>
          </div>

          <div class="group" data-open="true">
            <header><h3>Costs</h3><span>editable</span></header>
            <div class="body">
              <h3>Fixed</h3>
              <div id="fixedList" class="list" aria-live="polite"></div>
              <div style="display:flex;gap:8px;margin:8px 0 12px"><button class="btn" id="addFixed">+ Add item</button><button class="btn ghost" id="resetFixed">Reset → $50 default</button></div>
              <div class="grid-2">
                <div class="item"><span>Monthlyized total</span><span class="mono" id="fixedMonthly"></span></div>
                <div class="item"><span>Cash outflow this month</span><span class="mono" id="fixedThisMonth"></span></div>
              </div>
              <div style="height:10px"></div>
              <h3>Variable — AI Calls</h3>
              <div class="grid-2">
                <div><label for="costCallAttempt">Cost per call attempt ($)</label><input id="costCallAttempt" type="number" step="0.0001" value="0.40"></div>
                <div><label for="attemptsPerReach">Attempts per human reach</label><input id="attemptsPerReach" type="number" step="0.1" value="1.5"></div>
                <div><label>Cost per reached human (auto)</label><input id="costPerReach" type="number" disabled></div>
                <div><label>Cost for required contacts (auto)</label><input id="costCallsTotal" type="text" disabled></div>
              </div>
              <h3 style="margin-top:10px">Variable — Email</h3>
              <div class="grid-2">
                <div><label for="costEmailSend">Cost per email send ($)</label><input id="costEmailSend" type="number" step="0.0001" value="0.003"></div>
                <div><label for="sendsPerProspect">Sends per prospect</label><input id="sendsPerProspect" type="number" step="1" value="2"></div>
                <div><label>Cost per contacted prospect (auto)</label><input id="costEmailPerContact" type="number" disabled></div>
                <div><label>Cost for required contacts (auto)</label><input id="costEmailTotal" type="text" disabled></div>
              </div>
            </div>
          </div>
        </div>
      </aside>

      <!-- Results -->
      <main class="results">
        <!-- Summary KPIs -->
        <section class="panel"><div class="inner">
          <h3>Summary KPIs</h3>
          <div class="kpi-grid">
            <div class="kpi"><div class="value mono" id="revPerCarrierDisplay"></div><div class="label">Avenor revenue / carrier (selected)</div></div>
            <div class="kpi"><div class="value mono" id="derivedGross"></div><div class="label">Implied gross loads / carrier</div></div>
            <div class="kpi"><div class="value mono" id="whatIfRev"></div><div class="label">What-if revenue / carrier @ dispatch%</div></div>
            <div class="kpi"><div class="value mono" id="totalAvenorRevenue"></div><div class="label">Total Avenor reve
